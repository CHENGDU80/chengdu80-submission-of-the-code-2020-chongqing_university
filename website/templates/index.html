<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<title>Stock Prediction System-CQUSunrise</title>
	<!--plugins-->
	<link href="static/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
	<link href="static/plugins/perfect-scrollbar/css/perfect-scrollbar.css" rel="stylesheet" />
	<link href="static/plugins/metismenu/css/metisMenu.min.css" rel="stylesheet" />
	<link href="static/plugins/apexcharts-bundle/css/apexcharts.css" rel="stylesheet" />
	<!-- loader-->
	<link href="static/css/pace.min.css" rel="stylesheet" />
	<script src="static/js/pace.min.js"></script>
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="static/css/bootstrap.min.css" />
	<!-- Icons CSS -->
	<link rel="stylesheet" href="static/css/icons.css" />
	<!-- App CSS -->
	<link rel="stylesheet" href="static/css/app.css" />
	<link rel="stylesheet" href="static/css/dark-style.css" />
</head>

<body>
	<!-- wrapper -->
	<div class="wrapper">
		<!--header-->
		<header class="top-header">
			<nav class="navbar navbar-expand">
				<div class="left-topbar d-flex align-items-center">
					<a href="javaScript:;" class="toggle-btn">	<i class="bx bx-menu"></i>
					</a>
					<div class="logo-white">
						<img src="static/images/CQUEng.png" class="logo-icon" alt="">
					</div>
					<div class="logo-dark">
						<img src="static/images/CQUEng.png" class="logo-icon" alt="">
					</div>
				</div>
				<div>
					<div class="logo-black">
						<H5><i>S&P 500 Stock Trend</i></H5>
					</div>
				</div>
				<div class="flex-grow-1 search-bar">
					<div class="input-group">
						<div class="input-group-prepend search-arrow-back">
							<button class="btn btn-search-back" type="button"><i class="bx bx-arrow-back"></i>
							</button>
						</div>
						<input type="text" class="form-control" placeholder="search" />
						<div class="input-group-append">
							<button class="btn btn-search" type="button"><i class="lni lni-search-alt"></i>
							</button>
						</div>
					</div>
				</div>
			</nav>
		</header>
		<!--end header-->
		<!--page-wrapper-->
		<div class="page-wrapper">
			<!--sidebar-wrapper-->
			<div class="sidebar-wrapper" data-simplebar="true">
				<div class="sidebar-header">
					<a href="javaScript:;" class="toggle-btn"> <i class="bx bx-menu"></i>
					</a>

				</div>
				<!--navigation-->
				<ul class="metismenu" id="menu">
					<li>
						<a class="has-arrow" href="javaScript:;">
							<div class="parent-icon"><i class="bx bx-home-alt"></i>
							</div>
							<div class="menu-title">Dashboard</div>
						</a>
						<ul class="">
							<li> <a href="LSTM"><i class="bx bx-right-arrow-alt"></i>LSTM</a>
							</li>
							<li> <a href="ARIMA"><i class="bx bx-right-arrow-alt"></i>ARIMA</a>
							</li>
							<li> <a href="KnowledgeDistillation"><i class="bx bx-right-arrow-alt"></i>KnowledgeDistillation</a>
							</li>
						</ul>
					</li>
					<li class="menu-label">Web Apps</li>
					<li>
						<a href="ContactList">
							<div class="parent-icon"><i class="bx bx-group"></i>
							</div>
							<div class="menu-title">Contatcs</div>
						</a>
					</li>
					<li>
						<a href="TimeLine">
							<div class="parent-icon"> <i class="bx bx-video-recording"></i>
							</div>
							<div class="menu-title">Timeline</div>
						</a>
					</li>
				</ul>
				<!--end navigation-->
			</div>
			<!--end sidebar-wrapper-->
			<!--page-content-wrapper-->
			<div class="page-content-wrapper">
				<div class="page-content">
										<div class="card radius-10">
						<div class="card-header border-bottom-0">
							<div class="d-lg-flex align-items-center">
								<div>
									<h5 class="font-weight-bold mb-2 mb-lg-0">Please Input Ticker</h5>
								</div>
								<div class="ml-lg-auto mb-2 mb-lg-0">
									<div class="btn-group-round">
										<input id='company_name_input' type="text" class="form-control" placeholder="search" />
									</div>
								</div>
								<div>
									<button id="history_button" type="button" class="btn btn-primary radius-10 ml-lg-3">2012  History</button>
									<button id="predict_button" disabled="disabled" type="button" class="btn btn-primary radius-10 ml-lg-3">Prediction</button>
								</div>
							</div>
						</div>
						<div class="card-body">
							<div id="chart_lstm" style="width: 960px; height: 360px;"></div>
							<div id="chart_lstm_predict" style="width: 960px; height: 360px;"></div>
						</div>
					</div>

					<div class="row">
						<div class="col-12 col-lg-8">
							<div class="card radius-10">
								<div class="card-header border-bottom-0">
									<div class="d-lg-flex align-items-center">
										<div>
											<h5 class="font-weight-bold mb-2 mb-lg-0">Relation Analyse</h5>
										</div>
										<!-- <div class="ml-lg-auto mb-2 mb-lg-0">
											<div class="btn-group-round">
												<div class="btn-group">
													<button type="button" class="btn btn-white">This Month</button>
													<div class="dropdown-menu">	<a class="dropdown-item" href="javaScript:;">This Week</a>
														<a class="dropdown-item" href="javaScript:;">This Year</a>
													</div>
													<button type="button" class="btn btn-white dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">	<span class="sr-only">Toggle Dropdown</span>
													</button>
												</div>
											</div>
										</div> -->
									</div>
								</div>
								<div class="card-body">
									<div id="chart_company_ralation" style="height: 360px;"></div>
								</div>
							</div>
						</div>
						<div class="col-12 col-lg-4">
							<div class="card radius-10 bg-primary" style="height: 445px;">
								<div class="card-body">
							<!-- <div class="card radius-10 bg-primary" style="height: 445px;">
									<h6 class="text-white">Knowledge Distillation</h6>
									<h4 class="font-weight-bold text-white">3467</h4>
									<p class="font-13 text-white">Page view per minute</p>
									<div id="ichart654353"></div>
								</div> -->
							</div>
							<div class="card radius-10">
								<div class="card-body">
									<div class="revenue-by-channel">
										<h6 class="mb-4 font-weight-bold">Relation Analyse Commentary</h6>
										We calculated the percentage increase or decrease in the closing price of the S&P 500 company in 2012, and then
										calculated the correlation between the stock prices of each company based on the Spearman correlation coefficient, and
										found the companies with the highest correlation. Mouse over the histogram to view the name of the company.
										<!-- <div class="progress-wrapper">
											<div class="d-flex align-items-center">
												<div class="text-secondary">Direct</div>
												<div class="ml-auto pr-4">$1,24,685</div>
												<div class="text-success">65.6%</div>
											</div>
											<div class="progress mt-2" style="height:3px;">
												<div class="progress-bar" role="progressbar" style="width: 65%"></div>
											</div>
										</div>
										<div class="progress-wrapper mt-3">
											<div class="d-flex align-items-center">
												<div class="text-secondary">Referral</div>
												<div class="ml-auto pr-4">$1,22,863</div>
												<div class="text-success">45.6%</div>
											</div>
											<div class="progress mt-2" style="height:3px;">
												<div class="progress-bar" role="progressbar" style="width: 55%"></div>
											</div>
										</div>
										<div class="progress-wrapper mt-3">
											<div class="d-flex align-items-center">
												<div class="text-secondary">Social</div>
												<div class="ml-auto pr-4">$1,24,685</div>
												<div class="text-danger">25.2%</div>
											</div>
											<div class="progress mt-2" style="height:3px;">
												<div class="progress-bar" role="progressbar" style="width: 35%"></div>
											</div>
										</div> -->
									</div>
								</div>
							</div>
						</div>
					</div>
					<!--end row-->

										<div class="row">
											<div class="col-12 col-lg-8">
												<div class="card radius-10">
													<div class="card-header border-bottom-0">
														<div class="d-lg-flex align-items-center">
															<div>
																<h5 class="font-weight-bold mb-2 mb-lg-0">Knowledge Distillation</h5>
															</div>
															<!-- <div class="ml-lg-auto mb-2 mb-lg-0">
																					<div class="btn-group-round">
																						<div class="btn-group">
																							<button type="button" class="btn btn-white">This Month</button>
																							<div class="dropdown-menu">	<a class="dropdown-item" href="javaScript:;">This Week</a>
																								<a class="dropdown-item" href="javaScript:;">This Year</a>
																							</div>
																							<button type="button" class="btn btn-white dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">	<span class="sr-only">Toggle Dropdown</span>
																							</button>
																						</div>
																					</div>
																				</div> -->
														</div>
													</div>
													<div class="card-body">
														<div id="ichart6" style="height: 360px;"></div>
													</div>
												</div>
											</div>
											<div class="col-12 col-lg-4">
												<div class="card radius-10 bg-primary" style="height: 445px;">
													<div class="card-body">
														<!-- <div class="card radius-10 bg-primary" style="height: 445px;">
																			<h6 class="text-white">Knowledge Distillation</h6>
																			<h4 class="font-weight-bold text-white">3467</h4>
																			<p class="font-13 text-white">Page view per minute</p>
																			<div id="ichart654353"></div>
																		</div> -->
													</div>
													<div class="card radius-10">
														<div class="card-body">
															<div class="revenue-by-channel">
																<h6 class="mb-4 font-weight-bold">Knowledge Distillation</h6>
																The LSTM-based model has achieved good performance in the pursuit of accuracy. However, the black box characteristics of
																deep learning are very unfriendly to investors. We novelly use the method of knowledge distillation to distill the core
																knowledge from the deep learning model into logistic regression. The weight of the logistic regression model represents
																the influence of each factor. Mouse over the histogram to view the weight of the features.
																<!-- <div class="progress-wrapper">
																	<div class="d-flex align-items-center">
																		<div class="text-secondary">Direct</div>
																		<div class="ml-auto pr-4">$1,24,685</div>
																		<div class="text-success">65.6%</div>
																	</div>
																	<div class="progress mt-2" style="height:3px;">
																		<div class="progress-bar" role="progressbar" style="width: 65%"></div>
																	</div>
																</div>
																<div class="progress-wrapper mt-3">
																	<div class="d-flex align-items-center">
																		<div class="text-secondary">Referral</div>
																		<div class="ml-auto pr-4">$1,22,863</div>
																		<div class="text-success">45.6%</div>
																	</div>
																	<div class="progress mt-2" style="height:3px;">
																		<div class="progress-bar" role="progressbar" style="width: 55%"></div>
																	</div>
																</div>
																<div class="progress-wrapper mt-3">
																	<div class="d-flex align-items-center">
																		<div class="text-secondary">Social</div>
																		<div class="ml-auto pr-4">$1,24,685</div>
																		<div class="text-danger">25.2%</div>
																	</div>
																	<div class="progress mt-2" style="height:3px;">
																		<div class="progress-bar" role="progressbar" style="width: 35%"></div>
																	</div>
																</div> -->
															</div>
														</div>
													</div>
												</div>
											</div>
											<!--end row-->


					<div class="row">
						<div class="col-12 col-lg-12 col-xl-12">

							<div class="card">
								<div class="card-header border-bottom-0">
									<div class="d-lg-flex align-items-center">
										<div>
											<h5 class="font-weight-bold mb-2 mb-lg-0">News</h5>
										</div>
										<!-- <div class="ml-lg-auto mb-2 mb-lg-0">
											<div class="btn-group-round">
												<div class="btn-group">
													<button type="button" class="btn btn-white">This Month</button>
													<div class="dropdown-menu"> <a class="dropdown-item" href="javaScript:;">This Week</a>
														<a class="dropdown-item" href="javaScript:;">This Year</a>
													</div>
													<button type="button" class="btn btn-white dropdown-toggle dropdown-toggle-split"
														data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class="sr-only">Toggle
															Dropdown</span>
													</button>
												</div>
											</div>
										</div> -->
									</div>
								</div>
								<div class="card-body" id="news">
									<!-- <h2 class="card-title">title</h2>
									<h4 class="card-subtitle mb-2">time</h4>
									<p class="">content </p>

									<h2 class="card-title">title</h2>
									<h4 class="card-subtitle mb-2">time</h4>
									<p class="">content</p>

									<h2 class="card-title">title</h2>
									<h4 class="card-subtitle mb-2">time</h4>
									<p class="">content</p> -->
									<!-- <a href="#" class="card-link">Another link</a> -->
								</div>
							</div>
						</div>
					</div>
					<!-- end row -->
				</div>
			</div>
			<!--end page-content-wrapper-->
		</div>
		<!--end page-wrapper-->
		<!--start overlay-->
		<div class="overlay toggle-btn-mobile"></div>
		<!--end overlay-->
		<!--Start Back To Top Button--> <a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
		<!--End Back To Top Button-->
		<!--footer -->
		<div class="footer">
			<p class="mb-0">CHENGDU80 @2020 | Developed By : <a href="javaScript:" target="_blank">CQUSunrise Group</a>
			</p>
		</div>
		<!-- end footer -->
	</div>
	<!-- end wrapper -->


	 <!--start switcher-->
	   <!-- <div class="switcher-wrapper">
	       <div class="switcher-btn">
		       <i class='bx bx-cog bx-spin'></i>
		   </div>
		   <div class="switcher-body">
		      <h5 class="mb-0 text-uppercase">Theme Customizer</h5>
			  <hr/>
			  <h6 class="mb-0">Theme Styles</h6>
			  <hr/>
			  <div class="custom-control custom-radio">
				  <input type="radio" id="darkmode" name="customRadio" class="custom-control-input">
				  <label class="custom-control-label" for="darkmode">Dark Mode</label>
			  </div>
			  <hr/>
			  <div class="custom-control custom-radio">
			    <input type="radio" id="lightmode" name="customRadio" checked class="custom-control-input">
			    <label class="custom-control-label" for="lightmode">Light Mode</label>
			  </div>
		   </div>
	   </div> -->
	 <!--end switcher-->

	<!-- JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="static/js/jquery.min.js"></script>
	<script src="static/js/popper.min.js"></script>
	<script src="static/js/bootstrap.min.js"></script>
	<!--plugins-->
	<script src="static/plugins/simplebar/js/simplebar.min.js"></script>
	<script src="static/plugins/metismenu/js/metisMenu.min.js"></script>
	<script src="static/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
	<!--Apex chart-->
	<script src="static/plugins/apexcharts-bundle/js/apexcharts.min.js"></script>
	<script src="static/js/index.js"></script>
	<script src="static/js/echarts.min.js"></script>
	<!-- App JS -->
	<script src="static/js/app.js"></script>

<script>
	// 形成二维数组
	function formatDoubleDimensional(arr) {
		var result = []
		console.log(arr.length)
		for (var i = 0; i < arr.length; i++) {
			var tmpArr = []
			for (var attr in arr[i]) {
				var value = arr[i][attr]
				if (attr != "data") {
					value = parseFloat(value)
				}
				tmpArr.push(value)
			}
			result[i] = tmpArr
		}
		return result
	};


	$('#history_button').click(function (){
		var name = $('#company_name_input').val();
		name = name.replace(/^\s*|\s*$/g, "");
		if(name.length==0){
			alert('Please input a valid company name!');
			return;
		}

		var btn=document.getElementById("predict_button");
		// btn.style.display = "block";
		btn.removeAttribute('disabled');
		// btn.attr('disabled')="";


		// alert(name)
		$.post(
			"/static_k_data",
			{"company_name": name},
			function (data, status) {
				var my_k_chart = echarts.init(document.getElementById('chart_lstm'))

				// 指定图表的配置项和数据
				var upColor = '#ec0000';
				var upBorderColor = '#8A0000';
				var downColor = '#00da3c';
				var downBorderColor = '#008F28';

				function splitData(rawData) {
					var categoryData = [];
					var values = []
					for (var i = 0; i < rawData.length; i++) {
						categoryData.push(rawData[i].splice(0, 1)[0]);
						values.push(rawData[i])
					}
					return {
						categoryData: categoryData,
						values: values
					};
				}

				function calculateMA(dayCount, data) {
					var result = [];
					for (var i = 0, len = data.values.length; i < len; i++) {
						if (i < dayCount) {
							result.push('-');
							continue;
						}
						var sum = 0;
						for (var j = 0; j < dayCount; j++) {
							sum += data.values[i - j][1];
						}
						result.push(sum / dayCount);
					}
					return result;
				}
				data = JSON.parse(data)
				data = formatDoubleDimensional(data)
				data = splitData(data)
				option = {
					title: {
						text: 'Stock Momentum',
						left: 0
					},
					tooltip: {
						trigger: 'axis',
						axisPointer: {
							type: 'cross'
						}
					},
					legend: {
						data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30']
					},
					grid: {
						left: '10%',
						right: '10%',
						bottom: '15%'
					},
					xAxis: {
						type: 'category',
						data: data.categoryData,
						scale: true,
						boundaryGap: false,
						axisLine: { onZero: false },
						splitLine: { show: false },
						splitNumber: 20,
						min: 'dataMin',
						max: 'dataMax'
					},
					yAxis: {
						scale: true,
						splitArea: {
							show: true
						}
					},
					dataZoom: [
						{
							type: 'inside',
							start: 50,
							end: 100
						},
						{
							show: true,
							type: 'slider',
							top: '90%',
							start: 50,
							end: 100
						}
					],
					series: [
						{
							name: '日K',
							type: 'candlestick',
							data: data.values,
							itemStyle: {
								color: upColor,
								color0: downColor,
								borderColor: upBorderColor,
								borderColor0: downBorderColor
							},
							markPoint: {
								label: {
									normal: {
										formatter: function (param) {
											return param != null ? Math.round(param.value) : '';
										}
									}
								},
								data: [
									{
										name: 'XX标点',
										coord: ['2013/5/31', 2300],
										value: 2300,
										itemStyle: {
											color: 'rgb(41,60,85)'
										}
									},
									{
										name: 'highest value',
										type: 'max',
										valueDim: 'highest'
									},
									{
										name: 'lowest value',
										type: 'min',
										valueDim: 'lowest'
									},
									{
										name: 'average value on close',
										type: 'average',
										valueDim: 'close'
									}
								],
								tooltip: {
									formatter: function (param) {
										return param.name + '<br>' + (param.data.coord || '');
									}
								}
							},
							markLine: {
								symbol: ['none', 'none'],
								data: [
									[
										{
											name: 'from lowest to highest',
											type: 'min',
											valueDim: 'lowest',
											symbol: 'circle',
											symbolSize: 10,
											label: {
												show: false
											},
											emphasis: {
												label: {
													show: false
												}
											}
										},
										{
											type: 'max',
											valueDim: 'highest',
											symbol: 'circle',
											symbolSize: 10,
											label: {
												show: false
											},
											emphasis: {
												label: {
													show: false
												}
											}
										}
									],
									{
										name: 'min line on close',
										type: 'min',
										valueDim: 'close'
									},
									{
										name: 'max line on close',
										type: 'max',
										valueDim: 'close'
									}
								]
							}
						},
						{
						  name: 'MA5',
						  type: 'line',
						  data: calculateMA(5, data.values),
						  smooth: true,
						  lineStyle: {
						    opacity: 0.5
						  }
						},
						{
						  name: 'MA10',
						  type: 'line',
						  data: calculateMA(10, data.values),
						  smooth: true,
						  lineStyle: {
						    opacity: 0.5
						  }
						},
						{
						  name: 'MA20',
						  type: 'line',
						  data: calculateMA(20, data.values),
						  smooth: true,
						  lineStyle: {
						    opacity: 0.5
						  }
						},
						{
						  name: 'MA30',
						  type: 'line',
						  data: calculateMA(30, data.values),
						  smooth: true,
						  lineStyle: {
						    opacity: 0.5
						  }
						},

					]
				};
				my_k_chart.setOption(option)
			})
	})

	$('#predict_button').click(function () {
		var name = $('#company_name_input').val()
		// alert(name)
		$.post(
			"/predict_company_data_lstm",
			{ "company_name": name },
			function (data, status) {
				var my_k_chart_predict = echarts.init(document.getElementById('chart_lstm_predict'))
				data = JSON.parse(data)
				var ori_data = data.orgin
				var pre_data = data.predict
				var category_data = []
				var ori_close = []
				var predict_close = []
				ori_data = formatDoubleDimensional(ori_data)
				for (var i = 0; i < ori_data.length; i++) {
					category_data.push(ori_data[i][0])
					ori_close.push(ori_data[i][2])
					predict_close.push(ori_data[i][2])
				}
				for (var i = ori_data.length - 57, j = 0; i < ori_data.length, j < pre_data.length; i++, j++) {
					predict_close[i] = pre_data[j]
				}
				option_predict = {
					tooltip: {
						trigger: 'axis',
						axisPointer: {
							type: 'cross'
						}
					},
					legend: {
						data: ['origin', 'prediction']
					},
					grid: {
						left: '10%',
						right: '10%',
						bottom: '15%'
					},
					xAxis: {
						type: 'category',
						data: category_data,
						scale: true,
						boundaryGap: false,
						axisLine: { onZero: false },
						splitLine: { show: false },
						splitNumber: 20,
						min: 'dataMin',
						max: 'dataMax'
					},
					yAxis: {
						scale: true,
						splitArea: {
							show: true
						}
					},
					dataZoom: [
						{
							type: 'inside',
							start: 50,
							end: 100
						},
						{
							show: true,
							type: 'slider',
							top: '90%',
							start: 80,
							end: 100
						}
					],
					series: [{
						name: 'origin',
						data: ori_close,
						type: 'line',
						smooth: true
					},
					{
						name: 'prediction',
						data: predict_close,
						type: 'line',
						smooth: true
					}]
				};
				my_k_chart_predict.setOption(option_predict)
		})
		$.post(
			'/show_company_relation',
			{ "company_name": name },
			function (data, status) {
				data = JSON.parse(data)
				var company_category = []
				var company_value = []
				for(var x in data){
					company_category.push(x)
					company_value.push(data[x])
				}
				var company_relation_bar = echarts.init(document.getElementById('chart_company_ralation'))
				company_relation_bar_option = {
					// color: ['#3398DB'],
					tooltip: {
						trigger: 'axis',
						axisPointer: {            // 坐标轴指示器，坐标轴触发有效
							type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
						}
					},
					grid: {
						left: '3%',
						right: '4%',
						bottom: '3%',
						containLabel: true
					},
					xAxis: [
						{
							type: 'category',
							data: company_category,
							axisTick: {
								alignWithLabel: true
							}
						}
					],
					color: 'rgb(0,123,255)',
					yAxis: [
						{
							type: 'value'
						}
					],
					series: [
						{
							// name: '直接访问',
							type: 'bar',
							barWidth: '60%',
							data: company_value
						}
					]
				};

				// company_relation_bar_option = {
				// 	xAxis: {
				// 		type: 'category',
				// 		data: company_category
				// 	},
				// 	yAxis: {
				// 		type: 'value'
				// 	},
				// 	color: 'rgb(0,123,255)',
				// 	series: [{
				// 		data: company_value,
				// 		type: 'bar',
				// 		showBackground: true,
				// 		backgroundStyle: {
				// 			color: 'rgba(220, 220, 220, 0.8)'
				// 		}
				// 	}]
				// };
				company_relation_bar.setOption(company_relation_bar_option)

			}
		)

		$.post(
			'/show_kd',
			{ "company_name": name },
			function (data, status) {
				data = JSON.parse(data)
				var company_category =data['features'];
				var company_value = data['weight'];
				// for (var x in data) {
				// 	company_category.push(x)
				// 	company_value.push(data[x])
				// }
				var company_relation_bar = echarts.init(document.getElementById('ichart6'))
				company_relation_bar_option = {
					// color: ['#3398DB'],
					tooltip: {
						trigger: 'axis',
						axisPointer: {            // 坐标轴指示器，坐标轴触发有效
							type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
						}
					},
					grid: {
						left: '3%',
						right: '4%',
						bottom: '3%',
						containLabel: true
					},
					xAxis: [
						{
							type: 'category',
							data: company_category,
							axisTick: {
								alignWithLabel: true
							}
						}
					],
					color: 'rgb(0,123,255)',
					yAxis: [
						{
							type: 'value'
						}
					],
					series: [
						{
							// name: '直接访问',
							type: 'bar',
							barWidth: '60%',
							data: company_value
						}
					]
				};

				company_relation_bar.setOption(company_relation_bar_option)

			}
		)

	})

	$.get('/news', function (data) {
		data=JSON.parse(data);

		var table = document.getElementById("news");
			for(var j=0;j<3; j++){
				if (j > 3) {
							break;
						}

						var input1 = document.createElement('h5');
						input1.textContent = data[j].title;

						var input2 = document.createElement('h7');
						input2.textContent = data[j].date + ' ' + data[j].time;

						var input3 = document.createElement('p');
						input3.textContent = data[j].content.substr(0,200)+'...';

						table.appendChild(input1);
						table.appendChild(input2);
						table.appendChild(input3);
			}


	})
//origin_js_end
	var name = "A"

	$.post(
			"/static_k_data",
			{ "company_name": name },
			function (data, status) {
				var my_k_chart = echarts.init(document.getElementById('chart_lstm'))

				// 指定图表的配置项和数据
				var upColor = '#ec0000';
				var upBorderColor = '#8A0000';
				var downColor = '#00da3c';
				var downBorderColor = '#008F28';

				function splitData(rawData) {
					var categoryData = [];
					var values = []
					for (var i = 0; i < rawData.length; i++) {
						categoryData.push(rawData[i].splice(0, 1)[0]);
						values.push(rawData[i])
					}
					return {
						categoryData: categoryData,
						values: values
					};
				}

				function calculateMA(dayCount, data) {
					var result = [];
					for (var i = 0, len = data.values.length; i < len; i++) {
						if (i < dayCount) {
							result.push('-');
							continue;
						}
						var sum = 0;
						for (var j = 0; j < dayCount; j++) {
							sum += data.values[i - j][1];
						}
						result.push(sum / dayCount);
					}
					return result;
				}
				data = JSON.parse(data)
				data = formatDoubleDimensional(data)
				data = splitData(data)
				option = {
					title: {
						text: 'Stock Momentum',
						left: 0
					},
					tooltip: {
						trigger: 'axis',
						axisPointer: {
							type: 'cross'
						}
					},
					legend: {
						data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30']
					},
					grid: {
						left: '10%',
						right: '10%',
						bottom: '15%'
					},
					xAxis: {
						type: 'category',
						data: data.categoryData,
						scale: true,
						boundaryGap: false,
						axisLine: { onZero: false },
						splitLine: { show: false },
						splitNumber: 20,
						min: 'dataMin',
						max: 'dataMax'
					},
					yAxis: {
						scale: true,
						splitArea: {
							show: true
						}
					},
					dataZoom: [
						{
							type: 'inside',
							start: 50,
							end: 100
						},
						{
							show: true,
							type: 'slider',
							top: '90%',
							start: 50,
							end: 100
						}
					],
					series: [
						{
							name: '日K',
							type: 'candlestick',
							data: data.values,
							itemStyle: {
								color: upColor,
								color0: downColor,
								borderColor: upBorderColor,
								borderColor0: downBorderColor
							},
							markPoint: {
								label: {
									normal: {
										formatter: function (param) {
											return param != null ? Math.round(param.value) : '';
										}
									}
								},
								data: [
									{
										name: 'XX标点',
										coord: ['2013/5/31', 2300],
										value: 2300,
										itemStyle: {
											color: 'rgb(41,60,85)'
										}
									},
									{
										name: 'highest value',
										type: 'max',
										valueDim: 'highest'
									},
									{
										name: 'lowest value',
										type: 'min',
										valueDim: 'lowest'
									},
									{
										name: 'average value on close',
										type: 'average',
										valueDim: 'close'
									}
								],
								tooltip: {
									formatter: function (param) {
										return param.name + '<br>' + (param.data.coord || '');
									}
								}
							},
							markLine: {
								symbol: ['none', 'none'],
								data: [
									[
										{
											name: 'from lowest to highest',
											type: 'min',
											valueDim: 'lowest',
											symbol: 'circle',
											symbolSize: 10,
											label: {
												show: false
											},
											emphasis: {
												label: {
													show: false
												}
											}
										},
										{
											type: 'max',
											valueDim: 'highest',
											symbol: 'circle',
											symbolSize: 10,
											label: {
												show: false
											},
											emphasis: {
												label: {
													show: false
												}
											}
										}
									],
									{
										name: 'min line on close',
										type: 'min',
										valueDim: 'close'
									},
									{
										name: 'max line on close',
										type: 'max',
										valueDim: 'close'
									}
								]
							}
						},
						{
							name: 'MA5',
							type: 'line',
							data: calculateMA(5, data.values),
							smooth: true,
							lineStyle: {
								opacity: 0.5
							}
						},
						{
							name: 'MA10',
							type: 'line',
							data: calculateMA(10, data.values),
							smooth: true,
							lineStyle: {
								opacity: 0.5
							}
						},
						{
							name: 'MA20',
							type: 'line',
							data: calculateMA(20, data.values),
							smooth: true,
							lineStyle: {
								opacity: 0.5
							}
						},
						{
							name: 'MA30',
							type: 'line',
							data: calculateMA(30, data.values),
							smooth: true,
							lineStyle: {
								opacity: 0.5
							}
						},

					]
				};
				my_k_chart.setOption(option)
			})


	// alert(name)
	$.post(
		"/predict_company_data_lstm",
		{ "company_name": name },
		function (data, status) {
			var my_k_chart_predict = echarts.init(document.getElementById('chart_lstm_predict'))
			data = JSON.parse(data)
			var ori_data = data.orgin
			var pre_data = data.predict
			var category_data = []
			var ori_close = []
			var predict_close = []
			ori_data = formatDoubleDimensional(ori_data)
			for (var i = 0; i < ori_data.length; i++) {
				category_data.push(ori_data[i][0])
				ori_close.push(ori_data[i][2])
				predict_close.push(ori_data[i][2])
			}
			for (var i = ori_data.length - 57, j = 0; i < ori_data.length, j < pre_data.length; i++, j++) {
				predict_close[i] = pre_data[j]
			}
			option_predict = {
				tooltip: {
					trigger: 'axis',
					axisPointer: {
						type: 'cross'
					}
				},
				legend: {
					data: ['origin', 'prediction']
				},
				grid: {
					left: '10%',
					right: '10%',
					bottom: '15%'
				},
				xAxis: {
					type: 'category',
					data: category_data,
					scale: true,
					boundaryGap: false,
					axisLine: { onZero: false },
					splitLine: { show: false },
					splitNumber: 20,
					min: 'dataMin',
					max: 'dataMax'
				},
				yAxis: {
					scale: true,
					splitArea: {
						show: true
					}
				},
				dataZoom: [
					{
						type: 'inside',
						start: 50,
						end: 100
					},
					{
						show: true,
						type: 'slider',
						top: '90%',
						start: 80,
						end: 100
					}
				],
				series: [{
					name: 'origin',
					data: ori_close,
					type: 'line',
					smooth: true
				},
				{
					name: 'prediction',
					data: predict_close,
					type: 'line',
					smooth: true
				}]
			};
			my_k_chart_predict.setOption(option_predict)
	})
	$.post(
		'/show_company_relation',
		{ "company_name": name },
		function (data, status) {
			data = JSON.parse(data)
			var company_category = []
			var company_value = []
			for(var x in data){
				company_category.push(x)
				company_value.push(data[x])
			}
			var company_relation_bar = echarts.init(document.getElementById('chart_company_ralation'))
			company_relation_bar_option = {
				// color: ['#3398DB'],
				tooltip: {
					trigger: 'axis',
					axisPointer: {            // 坐标轴指示器，坐标轴触发有效
						type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
					}
				},
				grid: {
					left: '3%',
					right: '4%',
					bottom: '3%',
					containLabel: true
				},
				xAxis: [
					{
						type: 'category',
						data: company_category,
						axisTick: {
							alignWithLabel: true
						}
					}
				],
				color: 'rgb(0,123,255)',
				yAxis: [
					{
						type: 'value'
					}
				],
				series: [
					{
						// name: '直接访问',
						type: 'bar',
						barWidth: '60%',
						data: company_value
					}
				]
			};

			// company_relation_bar_option = {
			// 	xAxis: {
			// 		type: 'category',
			// 		data: company_category
			// 	},
			// 	yAxis: {
			// 		type: 'value'
			// 	},
			// 	color: 'rgb(0,123,255)',
			// 	series: [{
			// 		data: company_value,
			// 		type: 'bar',
			// 		showBackground: true,
			// 		backgroundStyle: {
			// 			color: 'rgba(220, 220, 220, 0.8)'
			// 		}
			// 	}]
			// };
			company_relation_bar.setOption(company_relation_bar_option)

		}
	)

	$.post(
		'/show_kd',
		{ "company_name": name },
		function (data, status) {
			data = JSON.parse(data)
			var company_category =data['features'];
			var company_value = data['weight'];
			// for (var x in data) {
			// 	company_category.push(x)
			// 	company_value.push(data[x])
			// }
			var company_relation_bar = echarts.init(document.getElementById('ichart6'))
			company_relation_bar_option = {
				// color: ['#3398DB'],
				tooltip: {
					trigger: 'axis',
					axisPointer: {            // 坐标轴指示器，坐标轴触发有效
						type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
					}
				},
				grid: {
					left: '3%',
					right: '4%',
					bottom: '3%',
					containLabel: true
				},
				xAxis: [
					{
						type: 'category',
						data: company_category,
						axisTick: {
							alignWithLabel: true
						}
					}
				],
				color: 'rgb(0,123,255)',
				yAxis: [
					{
						type: 'value'
					}
				],
				series: [
					{
						// name: '直接访问',
						type: 'bar',
						barWidth: '60%',
						data: company_value
					}
				]
			};

			company_relation_bar.setOption(company_relation_bar_option)

		})

	$.get('/news', function (data) {
		data=JSON.parse(data);

		var table = document.getElementById("news");
			for(var j=0;j<3; j++){
				if (j > 3)
				{
					break;
				}
				var input1 = document.createElement('h5');
				input1.textContent = data[j].title;

				var input2 = document.createElement('h7');
				input2.textContent = data[j].date + ' ' + data[j].time;

				var input3 = document.createElement('p');
				input3.textContent = data[j].content.substr(0,200)+'...';

				table.appendChild(input1);
				table.appendChild(input2);
				table.appendChild(input3);
			}
	})
</script>

</body>

</html>
