<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<title>Stock Prediction System</title>
	<!--favicon-->
	<link rel="icon" href="static/images/cqulog.png" type="image/png" />
	<!--plugins-->
	<link href="static/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
	<link href="static/plugins/perfect-scrollbar/css/perfect-scrollbar.css" rel="stylesheet" />
	<link href="static/plugins/metismenu/css/metisMenu.min.css" rel="stylesheet" />
	<link href="static/plugins/apexcharts-bundle/css/apexcharts.css" rel="stylesheet" />
	<!-- loader-->
	<link href="static/css/pace.min.css" rel="stylesheet" />
	<script src="static/js/pace.min.js"></script>
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="static/css/bootstrap.min.css" />
	<!-- Icons CSS -->
	<link rel="stylesheet" href="static/css/icons.css" />
	<!-- App CSS -->
	<link rel="stylesheet" href="static/css/app.css" />
	<link rel="stylesheet" href="static/css/dark-style.css" />
</head>

<body>
	<!-- wrapper -->
	<div class="wrapper">
		<!--header-->
		<header class="top-header">
			<nav class="navbar navbar-expand">
				<div class="left-topbar d-flex align-items-center">
					<a href="javaScript:;" class="toggle-btn">	<i class="bx bx-menu"></i>
					</a>
					<div class="logo-white">
						<img src="static/images/CQUEng.png" class="logo-icon" alt="">
					</div>
					<div class="logo-dark">
						<img src="static/images/CQUEng.png" class="logo-icon" alt="">
					</div>
				</div>
				<!-- <div class="flex-grow-1 search-bar">
					<div class="input-group">
						<div class="input-group-prepend search-arrow-back">
							<button class="btn btn-search-back" type="button"><i class="bx bx-arrow-back"></i>
							</button>
						</div>
						<input type="text" class="form-control" placeholder="search" />
						<div class="input-group-append">
							<button class="btn btn-search" type="button"><i class="lni lni-search-alt"></i>
							</button>
						</div>
					</div>
				</div> -->
			</nav>
		</header>
		<!--end header-->
		<!--page-wrapper-->
		<div class="page-wrapper">
			<!--sidebar-wrapper-->
			<div class="sidebar-wrapper" data-simplebar="true">
				<div class="sidebar-header">
					<a href="javaScript:;" class="toggle-btn"> <i class="bx bx-menu"></i>
					</a>
					<div class="logo-white">
						<img src="static/images/logo-white.png" class="logo-icon-2" alt="">
					</div>
					<div class="logo-dark">
						<img src="static/images/logo-dark.png" class="logo-icon-2" alt="">
					</div>
				</div>
				<!--navigation-->
				<ul class="metismenu" id="menu">
					<li>
						<a class="has-arrow" href="javaScript:;">
							<div class="parent-icon"><i class="bx bx-home-alt"></i>
							</div>
							<div class="menu-title">Dashboard</div>
						</a>
						<ul class="">
							<li> <a href="LSTM"><i class="bx bx-right-arrow-alt"></i>LSTM</a>
							</li>
							<li> <a href="ARIMA"><i class="bx bx-right-arrow-alt"></i>ARIMA</a>
							</li>
							<li> <a href="KnowledgeDistillation"><i class="bx bx-right-arrow-alt"></i>KnowledgeDistillation</a>
							</li>
						</ul>
					</li>
					<li class="menu-label">Web Apps</li>
					<li>
						<a href="ContactList">
							<div class="parent-icon"><i class="bx bx-group"></i>
							</div>
							<div class="menu-title">Contatcs</div>
						</a>
					</li>
					<li>
						<a href="TimeLime">
							<div class="parent-icon"> <i class="bx bx-video-recording"></i>
							</div>
							<div class="menu-title">Timeline</div>
						</a>
					</li>
				</ul>
				<!--end navigation-->
			</div>
			<!--end sidebar-wrapper-->
			<!--page-content-wrapper-->
			<div class="page-content-wrapper">
				<div class="page-content">
					<div class="row">
						<div class="col-12 col-lg-4">
							<div class="card radius-10">
								<div class="card-body">
									<div class="d-flex align-items-center">

										<div>
											<h6>Total Profit</h6>
											<h4 class="font-weight-bold mb-0">$8320</h4>
										</div>
										<div class="ml-auto"> <small class="text-danger float-right">(-72.16%) <i class='bx bx-down-arrow-alt'></i></small>
											<div id="chart1"></div>
										</div>


									</div>
								</div>
							</div>
						</div>

						<div class="col-12 col-lg-4">
							<div class="card radius-10">
								<div class="card-body">
									<div class="d-flex align-items-center">
										<div>
											<h6>Total Sales</h6>
											<h4 class="font-weight-bold mb-0">5264</h4>
										</div>
										<div class="ml-auto"> <small class="text-success float-right">(+68.26%) <i class='bx bx-up-arrow-alt'></i></small>
											<div id="chart2"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-12 col-lg-4">
							<div class="card radius-10">
								<div class="card-body">
									<div class="d-flex align-items-center">
										<div>
											<h6>Total Visitors</h6>
											<h4 class="font-weight-bold mb-0">22.7k</h4>
										</div>
										<div class="ml-auto"> <small class="text-success float-right">(+54.34%) <i class='bx bx-up-arrow-alt'></i></small>
											<div id="chart3"></div>
										</div>
									</div>
								</div>
							</div>
						</div>

					</div>
					<!--end row-->
					<div class="card radius-10">
						<div class="card-header border-bottom-0">
							<div class="d-lg-flex align-items-center">
								<div>
									<h5 class="font-weight-bold mb-2 mb-lg-0">Monthly Revenue</h5>
								</div>
								<div class="ml-lg-auto mb-2 mb-lg-0">
									<div class="btn-group-round">
										<input type="text" class="form-control" placeholder="search" />
									</div>
								</div>
								<div>
									<button id="history_button" type="button" class="btn btn-primary radius-10 ml-lg-3">History</button>
									<button id="predict_button" type="button" class="btn btn-primary radius-10 ml-lg-3">Prediction</button>
								</div>
							</div>
						</div>
						<div class="card-body">
							<div id="chart_lstm" style="width: 760px; height: 360px;"></div>
							<div id="chart_lstm_predict" style="width: 760px; height: 360px;"></div>
						</div>
					</div>

					<div class="row">
						<div class="col-12 col-lg-4 col-xl-4">
							<div class="card">
								<div class="card-body">
									<h5 class="card-title">标题</h5>
									<h6 class="card-subtitle mb-2">时间</h6>
									<p class="">Some quick example text to build on the card title and make up the bulk of the card's content.</p> <a href="#" class="card-link">链接</a>
									<!-- <a href="#" class="card-link">Another link</a> -->
								</div>
							</div>
						</div>
						<div class="col-12 col-lg-4 col-xl-4">
							<div class="card">
								<div class="card-body">
									<h5 class="card-title">标题</h5>
									<h6 class="card-subtitle mb-2">时间</h6>
									<p class="">Some quick example text to build on the card title and make up the bulk of the card's content.</p> <a href="#" class="card-link">链接</a>
									<!-- <a href="#" class="card-link">Another link</a> -->
								</div>
							</div>
						</div>
						<div class="col-12 col-lg-4 col-xl-4">
							<div class="card">
								<div class="card-body">
									<h5 class="card-title">标题</h5>
									<h6 class="card-subtitle mb-2">时间</h6>
									<p class="">Some quick example text to build on the card title and make up the bulk of the card's content.</p> <a href="#" class="card-link">链接</a>
									<!-- <a href="#" class="card-link">Another link</a> -->
								</div>
							</div>
						</div>
						<div class="col-12 col-lg-4 col-xl-4">
							<div class="card">
								<div class="card-body">
									<h5 class="card-title">标题</h5>
									<h6 class="card-subtitle mb-2">时间</h6>
									<p class="">Some quick example text to build on the card title and make up the bulk of the card's content.</p> <a href="#" class="card-link">链接</a>
									<!-- <a href="#" class="card-link">Another link</a> -->
								</div>
							</div>
						</div>
						<div class="col-12 col-lg-4 col-xl-4">
							<div class="card">
								<div class="card-body">
									<h5 class="card-title">标题</h5>
									<h6 class="card-subtitle mb-2">时间</h6>
									<p class="">Some quick example text to build on the card title and make up the bulk of the card's content.</p> <a href="#" class="card-link">链接</a>
									<!-- <a href="#" class="card-link">Another link</a> -->
								</div>
							</div>
						</div>
					</div>
					<!-- end row -->

					<div class="row">
						<div class="col-12 col-lg-8">
							<div class="card radius-10">
								<div class="card-header border-bottom-0">
									<div class="d-lg-flex align-items-center">
										<div>
											<h5 class="font-weight-bold mb-2 mb-lg-0">Historical Analytics</h5>
										</div>
										<div class="ml-lg-auto mb-2 mb-lg-0">
											<div class="btn-group-round">
												<div class="btn-group">
													<button type="button" class="btn btn-white">This Month</button>
													<div class="dropdown-menu">	<a class="dropdown-item" href="javaScript:;">This Week</a>
														<a class="dropdown-item" href="javaScript:;">This Year</a>
													</div>
													<button type="button" class="btn btn-white dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">	<span class="sr-only">Toggle Dropdown</span>
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="card-body">
									<div id="chart5"></div>
								</div>
							</div>
						</div>
						<div class="col-12 col-lg-4">
							<div class="card radius-10 bg-primary">
								<div class="card-body">
									<h6 class="text-white">Active Visitors</h6>
									<h4 class="font-weight-bold text-white">3467</h4>
									<p class="font-13 text-white">Page view per minute</p>
									<div id="chart6"></div>
								</div>
							</div>
							<div class="card radius-10">
								<div class="card-body">
									<div class="revenue-by-channel">
										<h6 class="mb-4 font-weight-bold">Revenue by Channel</h6>
										<div class="progress-wrapper">
											<div class="d-flex align-items-center">
												<div class="text-secondary">Direct</div>
												<div class="ml-auto pr-4">$1,24,685</div>
												<div class="text-success">65.6%</div>
											</div>
											<div class="progress mt-2" style="height:3px;">
												<div class="progress-bar" role="progressbar" style="width: 65%"></div>
											</div>
										</div>
										<div class="progress-wrapper mt-3">
											<div class="d-flex align-items-center">
												<div class="text-secondary">Referral</div>
												<div class="ml-auto pr-4">$1,22,863</div>
												<div class="text-success">45.6%</div>
											</div>
											<div class="progress mt-2" style="height:3px;">
												<div class="progress-bar" role="progressbar" style="width: 55%"></div>
											</div>
										</div>
										<div class="progress-wrapper mt-3">
											<div class="d-flex align-items-center">
												<div class="text-secondary">Social</div>
												<div class="ml-auto pr-4">$1,24,685</div>
												<div class="text-danger">25.2%</div>
											</div>
											<div class="progress mt-2" style="height:3px;">
												<div class="progress-bar" role="progressbar" style="width: 35%"></div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!--end row-->
				</div>
			</div>
			<!--end page-content-wrapper-->
		</div>
		<!--end page-wrapper-->
		<!--start overlay-->
		<div class="overlay toggle-btn-mobile"></div>
		<!--end overlay-->
		<!--Start Back To Top Button--> <a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
		<!--End Back To Top Button-->
		<!--footer -->
		<div class="footer">
			<p class="mb-0">CHENGDU80 @2020 | Developed By : <a href="javaScript:" target="_blank">CQUSunrise Group</a>
			</p>
		</div>
		<!-- end footer -->
	</div>
	<!-- end wrapper -->


	 <!--start switcher-->
	   <!-- <div class="switcher-wrapper">
	       <div class="switcher-btn">
		       <i class='bx bx-cog bx-spin'></i>
		   </div>
		   <div class="switcher-body">
		      <h5 class="mb-0 text-uppercase">Theme Customizer</h5>
			  <hr/>
			  <h6 class="mb-0">Theme Styles</h6>
			  <hr/>
			  <div class="custom-control custom-radio">
				  <input type="radio" id="darkmode" name="customRadio" class="custom-control-input">
				  <label class="custom-control-label" for="darkmode">Dark Mode</label>
			  </div>
			  <hr/>
			  <div class="custom-control custom-radio">
			    <input type="radio" id="lightmode" name="customRadio" checked class="custom-control-input">
			    <label class="custom-control-label" for="lightmode">Light Mode</label>
			  </div>
		   </div>
	   </div> -->
	 <!--end switcher-->

	<!-- JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="static/js/jquery.min.js"></script>
	<script src="static/js/popper.min.js"></script>
	<script src="static/js/bootstrap.min.js"></script>
	<!--plugins-->
	<script src="static/plugins/simplebar/js/simplebar.min.js"></script>
	<script src="static/plugins/metismenu/js/metisMenu.min.js"></script>
	<script src="static/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
	<!--Apex chart-->
	<script src="static/plugins/apexcharts-bundle/js/apexcharts.min.js"></script>
	<script src="static/js/index.js"></script>
	<script src="static/js/echarts.min.js"></script>
	<!-- App JS -->
	<script src="static/js/app.js"></script>
<script>
	// 形成二维数组
	function formatDoubleDimensional(arr) {
		var result = []
		console.log(arr.length)
		for (var i = 0; i < arr.length; i++) {
			var tmpArr = []
			for (var attr in arr[i]) {
				var value = arr[i][attr]
				if (attr != "data") {
					value = parseFloat(value)
				}
				tmpArr.push(value)
			}
			result[i] = tmpArr
		}
		return result
	};

	$('#history_button').click(function (){
		var name = $('input').val()
		alert(name)
		$.post(
			"/static_k_data",
			{"company_name": name},
			function (data, status) {
				var my_k_chart = echarts.init(document.getElementById('chart_lstm'))

				// 指定图表的配置项和数据
				var upColor = '#ec0000';
				var upBorderColor = '#8A0000';
				var downColor = '#00da3c';
				var downBorderColor = '#008F28';

				function splitData(rawData) {
					var categoryData = [];
					var values = []
					for (var i = 0; i < rawData.length; i++) {
						categoryData.push(rawData[i].splice(0, 1)[0]);
						values.push(rawData[i])
					}
					return {
						categoryData: categoryData,
						values: values
					};
				}

				function calculateMA(dayCount, data) {
					var result = [];
					for (var i = 0, len = data.values.length; i < len; i++) {
						if (i < dayCount) {
							result.push('-');
							continue;
						}
						var sum = 0;
						for (var j = 0; j < dayCount; j++) {
							sum += data.values[i - j][1];
						}
						result.push(sum / dayCount);
					}
					return result;
				}
				data = JSON.parse(data)
				data = formatDoubleDimensional(data)
				data = splitData(data)
				option = {
					title: {
						text: 'Stock Momentum',
						left: 0
					},
					tooltip: {
						trigger: 'axis',
						axisPointer: {
							type: 'cross'
						}
					},
					legend: {
						data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30']
					},
					grid: {
						left: '10%',
						right: '10%',
						bottom: '15%'
					},
					xAxis: {
						type: 'category',
						data: data.categoryData,
						scale: true,
						boundaryGap: false,
						axisLine: { onZero: false },
						splitLine: { show: false },
						splitNumber: 20,
						min: 'dataMin',
						max: 'dataMax'
					},
					yAxis: {
						scale: true,
						splitArea: {
							show: true
						}
					},
					dataZoom: [
						{
							type: 'inside',
							start: 50,
							end: 100
						},
						{
							show: true,
							type: 'slider',
							top: '90%',
							start: 50,
							end: 100
						}
					],
					series: [
						{
							name: '日K',
							type: 'candlestick',
							data: data.values,
							itemStyle: {
								color: upColor,
								color0: downColor,
								borderColor: upBorderColor,
								borderColor0: downBorderColor
							},
							markPoint: {
								label: {
									normal: {
										formatter: function (param) {
											return param != null ? Math.round(param.value) : '';
										}
									}
								},
								data: [
									{
										name: 'XX标点',
										coord: ['2013/5/31', 2300],
										value: 2300,
										itemStyle: {
											color: 'rgb(41,60,85)'
										}
									},
									{
										name: 'highest value',
										type: 'max',
										valueDim: 'highest'
									},
									{
										name: 'lowest value',
										type: 'min',
										valueDim: 'lowest'
									},
									{
										name: 'average value on close',
										type: 'average',
										valueDim: 'close'
									}
								],
								tooltip: {
									formatter: function (param) {
										return param.name + '<br>' + (param.data.coord || '');
									}
								}
							},
							markLine: {
								symbol: ['none', 'none'],
								data: [
									[
										{
											name: 'from lowest to highest',
											type: 'min',
											valueDim: 'lowest',
											symbol: 'circle',
											symbolSize: 10,
											label: {
												show: false
											},
											emphasis: {
												label: {
													show: false
												}
											}
										},
										{
											type: 'max',
											valueDim: 'highest',
											symbol: 'circle',
											symbolSize: 10,
											label: {
												show: false
											},
											emphasis: {
												label: {
													show: false
												}
											}
										}
									],
									{
										name: 'min line on close',
										type: 'min',
										valueDim: 'close'
									},
									{
										name: 'max line on close',
										type: 'max',
										valueDim: 'close'
									}
								]
							}
						},
						{
						  name: 'MA5',
						  type: 'line',
						  data: calculateMA(5, data.values),
						  smooth: true,
						  lineStyle: {
						    opacity: 0.5
						  }
						},
						{
						  name: 'MA10',
						  type: 'line',
						  data: calculateMA(10, data.values),
						  smooth: true,
						  lineStyle: {
						    opacity: 0.5
						  }
						},
						{
						  name: 'MA20',
						  type: 'line',
						  data: calculateMA(20, data.values),
						  smooth: true,
						  lineStyle: {
						    opacity: 0.5
						  }
						},
						{
						  name: 'MA30',
						  type: 'line',
						  data: calculateMA(30, data.values),
						  smooth: true,
						  lineStyle: {
						    opacity: 0.5
						  }
						},

					]
				};
				my_k_chart.setOption(option)
			})
	})

	$('#predict_button').click(function () {
		var name = $('input').val()
		alert(name)
		$.post(
			"/predict_company_data_lstm",
			{ "company_name": name },
			function (data, status) {
				var my_k_chart_predict = echarts.init(document.getElementById('chart_lstm_predict'))
				data = JSON.parse(data)
				var ori_data = data.orgin
				var pre_data = data.predict
				var category_data = []
				var ori_close = []
				var predict_close = []
				ori_data = formatDoubleDimensional(ori_data)
				for (var i = 0; i < ori_data.length; i++) {
					category_data.push(ori_data[i][0])
					ori_close.push(ori_data[i][2])
					predict_close.push(ori_data[i][2])
				}
				for (var i = ori_data.length - 57, j = 0; i < ori_data.length, j < pre_data.length; i++, j++) {
					predict_close[i] = pre_data[j]
				}
				option_predict = {
					tooltip: {
						trigger: 'axis',
						axisPointer: {
							type: 'cross'
						}
					},
					legend: {
						data: ['origin', 'prediction']
					},
					grid: {
						left: '10%',
						right: '10%',
						bottom: '15%'
					},
					xAxis: {
						type: 'category',
						data: category_data,
						scale: true,
						boundaryGap: false,
						axisLine: { onZero: false },
						splitLine: { show: false },
						splitNumber: 20,
						min: 'dataMin',
						max: 'dataMax'
					},
					yAxis: {
						scale: true,
						splitArea: {
							show: true
						}
					},
					dataZoom: [
						{
							type: 'inside',
							start: 50,
							end: 100
						},
						{
							show: true,
							type: 'slider',
							top: '90%',
							start: 80,
							end: 100
						}
					],
					series: [{
						name: 'origin',
						data: ori_close,
						type: 'line',
						smooth: true
					},
					{
						name: 'prediction',
						data: predict_close,
						type: 'line',
						smooth: true
					}]
				};
				my_k_chart_predict.setOption(option_predict)
		})
	})

</script>

</body>

</html>
